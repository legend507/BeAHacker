/*
This program takes 

printf(string);         <- vulnerable
printf("%s", string);   <- safe
both can print out string, but the first method can be exploited.
*/
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(int argc, char* argv[]) {
    char text[1024];
    static int test_val = -72;

    if(argc < 2) {
        printf("Usage: %s <text to print>\n", argv[0]);
        exit(0);
    }
    strcpy(text, argv[1]);

    printf("The right way to print user-controlled input (printf(\"%%s\", string)):\n");
    printf("%s", text);

    printf("\nThe wrong way to print user-controlled input (printf(string)):\n");
    printf(text);

    printf("\n");

    // Debug output
    printf("[*] test_val @ 0x%08x = %d 0x%08x\n", &test_val, test_val, test_val);

    exit(0);
}

/*
Now try to exploit the 1st method.

1. ./a.out testing
    the 2 methods output testing, no problem here

2. ./a.out testing%x
    printf(string);         <- testing61fb30
    printf("%s", string);   <- testing%x
    Explain: when %x is used, a 4-byte word (following string in stack) will be printed, use this to exam stack frame

3. ./a.out $(perl -e 'print "%08x."x40')
    (only works on Linux)
    ToDo: 
*/
